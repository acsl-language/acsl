name: compile

on: [push,pull_request]

jobs:
  compile:
    name: compile the manuals
    runs-on: ubuntu-latest
    steps:
      - name: retrieve sources
        uses: actions/checkout@v2
      - name: compile acsl manual
        uses: dante-ev/latex-action@latest
        with: 
          root_file: main.tex
          compiler: make
          args: acsl.pdf
          extra_system_packages: make ocaml-nox
      - name: archive ACSL log
        if: ${{ always() }}
        uses: actions/upload-artifact@v2
        with:
          path: acsl.log
      - name: compile acsl++ manual
        run: make acslpp.pdf
      - name: archive pdf
        uses: actions/upload-artifact@v2
        with:
          path: |
            acsl.pdf
            acslpp.pdf
      - name: check grammar coherence
        run: make grammar-check
